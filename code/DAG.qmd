---
title: "DAG"
format: html
---

```{r}

library(ggdag)
library(ggplot2)

```

```{r}

survival_dag = dagify(Survival ~ EMT_Score + Disease_Stage + Age + Immune_Infiltrate + Treatment + Sex + CAF_Infiltrate,
                      EMT_Score ~ Disease_Stage +  Tissue_Rollup,
                      Treatment ~ Disease_Stage + Sample_Collection_Year,
                      Immune_Infiltrate ~ Tissue_Rollup,
                      Tissue_Rollup ~ Disease_Stage,
                      labels = c("Survival" = "Survival",
                                 "EMT_Score" = "EMT\nScore",
                                 "Disease_Stage" = "Disease Stage",
                                 "Age" = "Patient\nAge",
                                 "Tissue_Rollup" = "Sample Tissue\nSource",
                                 "Immune_Infiltrate" = "Immune\nInfiltrate",
                                 "Sample_Collection_Year" = "Year Sample\nCollected",
                                 "Treatment" = "Treatment(s)\nReceived",
                                 "Sex" = "Patient\nSex",
                                 "CAF_Infiltrate" = "Cancer Associated\nFibroblasts"),
                      exposure = "EMT_Score",
                      outcome = "Survival")


ggdag(survival_dag, text = FALSE, use_labels = "label") +
    theme_dag()


```
#Save DAG Image
```{r}

png(file = "../outputs/DAG.png", bg = "white")
ggdag(survival_dag, text = FALSE, use_labels = "label") +
    theme_dag()
dev.off()

```


```{r}

#Backdoor paths
ggdag_paths(survival_dag,
            from = "EMT_Score",
            to = "Survival") 

#Adjustment sets
ggdag_adjustment_set(survival_dag,
                     exposure = c("EMT_Score"),
                     outcome = "Survival",
                     text = FALSE,
                     use_labels = "label") +
  theme_dag_blank()

```

